<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ImageManager Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #1a1a2e;
            color: white;
        }
        .test-container {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #333;
            border-radius: 8px;
            background-color: #2a2a3e;
        }
        .card-image-wrapper {
            display: inline-block;
            margin: 10px;
            border: 2px solid #ffd700;
            border-radius: 8px;
            overflow: hidden;
        }
        .card-image {
            display: block;
        }
        .card-image-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #4A90E2;
            border: 2px solid #333;
            border-radius: 8px;
            min-height: 145px;
            min-width: 100px;
        }
        .placeholder-content {
            text-align: center;
            color: white;
        }
        .placeholder-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }
        .placeholder-text {
            font-size: 12px;
        }
        #test-results {
            margin-top: 20px;
            padding: 20px;
            background-color: #2a2a3e;
            border-radius: 8px;
            border: 1px solid #333;
        }
    </style>
</head>
<body>
    <h1>üß™ ImageManager Test Page</h1>
    <p>Testing the image display fix for data URLs</p>
    
    <div class="test-container">
        <h2>Test 1: Direct Image Display</h2>
        <div id="test-image-container"></div>
    </div>
    
    <div class="test-container">
        <h2>Test 2: Placeholder Display</h2>
        <div id="test-placeholder-container"></div>
    </div>
    
    <div class="test-container">
        <h2>Test 3: Cached Image Display</h2>
        <div id="test-cached-container"></div>
    </div>
    
    <div id="test-results">
        <h3>Test Results</h3>
        <div id="results-output">Running tests...</div>
    </div>
    
    <script type="module">
        import { ImageManager } from './src/js/utils/ImageManager.js';
        
        async function runVisualTests() {
            const results = document.getElementById('results-output');
            const imageManager = new ImageManager();
            
            try {
                results.innerHTML = '‚è≥ Running visual tests...<br>';
                
                // Test 1: Direct image display with data URL
                const canvas1 = document.createElement('canvas');
                canvas1.width = 100;
                canvas1.height = 145;
                const ctx1 = canvas1.getContext('2d');
                
                // Create a colorful test pattern
                ctx1.fillStyle = '#FF0000';
                ctx1.fillRect(0, 0, 33, 145);
                ctx1.fillStyle = '#00FF00';
                ctx1.fillRect(33, 0, 34, 145);
                ctx1.fillStyle = '#0000FF';
                ctx1.fillRect(67, 0, 33, 145);
                
                const testDataUrl = canvas1.toDataURL('image/png');
                
                const testImg = new Image();
                testImg.src = testDataUrl;
                testImg.style.width = '100px';
                testImg.style.height = '145px';
                testImg.style.objectFit = 'contain';
                
                await new Promise(resolve => testImg.onload = resolve);
                
                const container1 = document.getElementById('test-image-container');
                imageManager.displayImage(testImg, container1);
                
                results.innerHTML += '‚úÖ Test 1: Direct image display - PASSED<br>';
                
                // Test 2: Placeholder display
                const container2 = document.getElementById('test-placeholder-container');
                imageManager.displayPlaceholder(container2, 'Test Card Placeholder');
                
                results.innerHTML += '‚úÖ Test 2: Placeholder display - PASSED<br>';
                
                // Test 3: Cached image simulation
                const canvas3 = document.createElement('canvas');
                canvas3.width = 100;
                canvas3.height = 145;
                const ctx3 = canvas3.getContext('2d');
                
                // Create a different pattern
                ctx3.fillStyle = '#FFD700';
                ctx3.fillRect(0, 0, 100, 145);
                ctx3.fillStyle = '#8B4513';
                ctx3.beginPath();
                ctx3.arc(50, 72, 30, 0, 2 * Math.PI);
                ctx3.fill();
                
                const cachedDataUrl = canvas3.toDataURL('image/png');
                const cachedImg = await imageManager.createImageFromData(cachedDataUrl, { width: 100, height: 145 });
                
                const container3 = document.getElementById('test-cached-container');
                imageManager.displayImage(cachedImg, container3);
                
                results.innerHTML += '‚úÖ Test 3: Cached image display - PASSED<br>';
                
                results.innerHTML += '<br><strong>üéâ All visual tests completed successfully!</strong><br>';
                results.innerHTML += '<br>If you can see the colored test images above, the fix is working correctly.';
                
            } catch (error) {
                results.innerHTML += `‚ùå Test failed: ${error.message}<br>`;
                console.error('Test error:', error);
            }
        }
        
        // Run tests when page loads
        window.addEventListener('load', runVisualTests);
    </script>
</body>
</html>